-- BÀI TẬP NHÓM _ QUẢN LÍ NHÀ HÀNG 13/10/20221
-- TẠO CSDL
CREATE DATABASE BAITAP_NHOM

USE BAITAP_NHOM

GO
-- TẠO BẢNG KHÁCH HÀNG
CREATE TABLE KHACH_HANG
(
	MKH VARCHAR(5) NOT NULL PRIMARY KEY ,
	TENKH NVARCHAR(50) NOT NULL,
	DIACHI NVARCHAR(20) NOT NULL,
	SDT VARCHAR (15) NOT NULL,
	TENDN VARCHAR(10) NOT NULL,
	MK VARCHAR(10) NOT NULL
)
ALTER TABLE KHACH_HANG
ADD GIOITINH NVARCHAR(5) NOT NULL
GO
-- TẠO BẢNG NHÂN VIÊN
CREATE TABLE NHAN_VIEN
(
	MNV VARCHAR(5) NOT NULL PRIMARY KEY,
	TENNV NVARCHAR(50) NOT NULL,
	DIACHI NVARCHAR(20) NOT NULL,
	GIOITINH NVARCHAR(5) NOT NULL,
	NGAYSINH DATE NOT NULL,
	SDT VARCHAR (15) NOT NULL,
	CHUCVU NVARCHAR(20) NOT NULL,
	TENDN VARCHAR(10) NOT NULL,
	MK VARCHAR(10) NOT NULL
)

GO
 CREATE TABLE CA_LAM_VIEC
 (
	MACA VARCHAR(5) NOT NULL PRIMARY KEY ,
	TENCA NVARCHAR(20) NOT NULL,-- BTH , LỄ (*3), NGÀY NGHĨ(*1.5)
	LUONG FLOAT NOT NULL,
 )

GO
 CREATE TABLE LUONG_THEO_CA
 (
	SLCA SMALLINT PRIMARY KEY NOT NULL,
	MACA VARCHAR(5) NOT NULL FOREIGN KEY REFERENCES CA_LAM_VIEC(MACA),
	MNV VARCHAR(5) NOT NULL FOREIGN KEY REFERENCES NHAN_VIEN(MNV),
)

 GO
-- TẠO BẢNG CHI TIẾT ĐẶT BÀN
CREATE TABLE CHI_TIET_DAT_BAN
(
	MBAN VARCHAR(5) NOT NULL ,
	MNV VARCHAR(5) NOT NULL ,
	MKH VARCHAR(5) NOT NULL ,
	MSP VARCHAR(5) NOT NULL,
	NGAYDAT DATE NOT NULL,
	NGAYDEN DATE NOT NULL,
	TIENCOC FLOAT NOT NULL,
	CONSTRAINT FK_NV FOREIGN KEY (MNV) REFERENCES NHAN_VIEN(MNV),
	CONSTRAINT FK_KH FOREIGN KEY (MKH) REFERENCES KHACH_HANG(MKH),
	CONSTRAINT PK_DB PRIMARY KEY (MBAN, MNV)
)
GO
--TẠO BẢNG HÓA ĐƠN
CREATE TABLE HOA_DON
(
	MHD VARCHAR(5) NOT NULL PRIMARY KEY,
	NGAYTAO DATE NOT NULL,
	TONGTIEN FLOAT NOT NULL,
	MBAN VARCHAR(5) NOT NULL,
	MNV VARCHAR(5) NOT NULL ,
	CONSTRAINT FK_HOADON	FOREIGN KEY (MBAN,MNV) REFERENCES CHI_TIET_DAT_BAN (MBAN,MNV)
)
GO
-- TẠO BẢNG LOẠI SẢN PHẨM
CREATE TABLE LOAI_SAN_PHAM
(	
	MLSP VARCHAR(5) NOT NULL PRIMARY KEY,
	TENLSP NVARCHAR(20) NOT NULL
)

GO
-- TẠO BẢNG SẢN PHẨM
CREATE TABLE SAN_PHAM
(
	MSP VARCHAR (5) NOT NULL PRIMARY KEY,
	TENSP NVARCHAR(50) NOT NULL,
	SOLUONG SMALLINT NOT NULL,
	DONGIA FLOAT NOT NULL,
	DVT NVARCHAR(15) NOT NULL,
	MLSP VARCHAR(5) NOT NULL FOREIGN KEY REFERENCES LOAI_SAN_PHAM(MLSP),
	ANHSP VARCHAR(100) NOT NULL,
)


GO

-- TẠO BẢNG CHI TIẾT HÓA ĐƠN
CREATE TABLE CHI_TIET_HOA_DON
(
	SOLUONG TINYINT NOT NULL,
	DONGIA FLOAT NOT NULL,
	MHD VARCHAR(5) NOT NULL FOREIGN KEY REFERENCES HOA_DON(MHD),
	MSP VARCHAR (5) NOT NULL FOREIGN KEY REFERENCES SAN_PHAM(MSP),
)

GO
CREATE TABLE NHA_CUNG_CAP
(
	MANCC VARCHAR(10) NOT NULL PRIMARY KEY,
	TENNCC NVARCHAR(50) NOT NULL,
	DIACHI NVARCHAR(20) NOT NULL,
	SDT VARCHAR (15) NOT NULL,
)

GO
CREATE TABLE NGUYEN_LIEU
(
	MANL VARCHAR(10) NOT NULL PRIMARY KEY,
	TENNL NVARCHAR(50) NOT NULL,
	NGAYNHAP DATE NOT NULL,
	DONGIA FLOAT NOT NULL,
	DVT NVARCHAR(15) NOT NULL,
)

GO
CREATE TABLE HOA_DON_NHAP
(
	MHD VARCHAR(5) NOT NULL PRIMARY KEY,
	NGAYTAO DATE NOT NULL,
	TONGTIEN FLOAT NOT NULL,
	MNV VARCHAR(5) NOT NULL ,
	MANCC VARCHAR(10) NOT NULL,
	CONSTRAINT FK_HOADONNHAP	FOREIGN KEY (MNV) REFERENCES NHAN_VIEN (MNV),
	CONSTRAINT FK_HOADONNHAP2	FOREIGN KEY (MANCC) REFERENCES NHA_CUNG_CAP(MANCC),
)

CREATE TABLE CHI_TIET_HOA_DON_NHAP
(
	SOLUONG SMALLINT NOT NULL,
	DONGIA FLOAT NOT NULL,
	MHD VARCHAR(5) NOT NULL FOREIGN KEY REFERENCES HOA_DON_NHAP(MHD),
	MANL VARCHAR(10) NOT NULL FOREIGN KEY REFERENCES NGUYEN_LIEU(MANL),
)











--=================================================================================

-- NHẬP DỮ LIỆU BẢNG NHÂN VIÊN
INSERT NHAN_VIEN VALUES('01',N'Trần Văn Hòa',N'123 Hòn Chồng','Nam','1/2/1995','0123456',N'QUẢN LÍ','quanli','quanli')
INSERT NHAN_VIEN VALUES('02',N'Lê Văn Đức',N'12 Phan Trọng Tuệ ','Nam','2/4/2001','0139283',N'Phục vụ','ducle','ducle24')
INSERT NHAN_VIEN VALUES('03',N'Bùi Ngọc Hoa',N'11 Củ Chi ',N'Nữ','12/4/2000','0139999',N'Lễ tân','hoabui','hoabui12')
INSERT NHAN_VIEN VALUES('04',N'Lê Văn Sang',N'05 Phan Trọng Tuệ ','Nam','3/6/2000','0233283',N'Phục vụ','sangle','sangle36')
INSERT NHAN_VIEN VALUES('05',N'Nguyễn Khánh An',N'33 Bắc Sơn',N'Nữ','8/4/2002','0133554',N'Thu ngân','annguyen','annguyen84')

-- NHẬP DỮ LIỆU BẢNG CA LÀM VIỆC
INSERT CA_LAM_VIEC VALUES ('CA01',N'Ngày thường',200.000)
INSERT CA_LAM_VIEC VALUES ('CA02',N'Ngày lễ',600.000)
INSERT CA_LAM_VIEC VALUES ('CA03',N'Cuối tuần',350.000)

-- NHẬP DỮ LIỆU BẢNG LƯƠNG THEO CA
INSERT LUONG_THEO_CA VALUES (15,'CA01','01')
INSERT LUONG_THEO_CA VALUES (20,'CA02','02')
INSERT LUONG_THEO_CA VALUES (18,'CA03','03')
INSERT LUONG_THEO_CA VALUES (10,'CA02','04')
INSERT LUONG_THEO_CA VALUES (14,'CA01','05')

-- NHẬP DỮ LIỆU BẢNG KHÁCH HÀNG
INSERT KHACH_HANG VALUES ('KH1',N'Đinh Gia Khánh',N'13/23 Bắc Sơn','0331234','khanhdinh','khanh123',N'Nam')
INSERT KHACH_HANG VALUES ('KH2',N'Nguyễn Trân Anh',N'233 Điện Biên Phủ','0331122','trananh ','trananh22 ',N'Nữ')
INSERT KHACH_HANG VALUES ('KH3',N'Nguyễn Khánh Duy',N'25 Nguyễn Đình Chiểu','0333342','khanhduy','duy3342',N'Nam')
INSERT KHACH_HANG VALUES ('KH4',N'Phan Thị Huyền Trâm',N'80/23 Bắc Sơn','0338877','tramphan','tramphan77',N'Nữ')
INSERT KHACH_HANG VALUES ('KH5',N'Đinh Văn Bảo',N'02 Nguyễn Đình Chiểu','0334343','baodinh','bao4343',N'Nam')


-- NHẬP DỮ LIỆU BẢNG NHÀ CUNG CẤP
INSERT NHA_CUNG_CAP VALUES ('NCC1',N'Hải sản Khánh Duy',N'Vĩnh Hải','0221212')
INSERT NHA_CUNG_CAP VALUES ('NCC2',N'Trại gà Minh Trí',N'Vạn Giã','02233222')
INSERT NHA_CUNG_CAP VALUES ('NCC3',N'Thịt bò Quốc Châu',N'Vĩnh Trường','0224532')
INSERT NHA_CUNG_CAP VALUES ('NCC4',N'Rau sạch Huyền Trâm',N'Đà Lạt','02277666')
INSERT NHA_CUNG_CAP VALUES ('NCC5',N'Giải Khát Tuấn Kiệt',N'Vĩnh Thọ','0221999')

-- NHẬP DỮ LIỆU BẢNG LOẠI SẢN PHẢM

INSERT LOAI_SAN_PHAM VALUES ('HS01',N'Tôm hùm')
INSERT LOAI_SAN_PHAM VALUES ('TH02',N'Gà')
INSERT LOAI_SAN_PHAM VALUES ('GK03',N'Bia')
INSERT LOAI_SAN_PHAM VALUES ('RA04',N'Salat')


-- NHẬP DỮ LIỆU BẢNG SẢN PHẢM










delete from LOAI_SAN_PHAM
select * from NHAN_VIEN

-- tìm ra danh khach hang nam
select * from KHACH_HANG where GIOITINH = 'nam'
-- tính lương các nhân viên nam
select a.TENNV,b.TENCA,c.SLCA ,sum(b.LUONG*c.SLCA) as lương
from NHAN_VIEN a, CA_LAM_VIEC b, LUONG_THEO_CA c
where a.MNV = c.MNV and b.MACA = c.MACA 
group by a.TENNV,b.TENCA,c.SLCA 
order by c.slca desc

--  AGGREGATE FUNTION 1.TÍNH LUONG NHÂN  VIÊN
/*SELECT A.MNV,SUM(B.SOLUONGCA*C.LUONGTHEOCA) AS LUONG
FROM NHAN_VIEN A, LUONG B, CA_LAM_VIEC C
WHERE A.MNV = B.MNV AND B.MACA = C.MACA
GROUP BY A.MNV,C.LUONGTHEOCA
ORDER BY LUONG DESC*/